{% extends "base.html" %}
{% load static %}

{% block title %}{{ blog.title }} - BlogHub{% endblock %}

{% block maincontent %}
<div class="container py-5">

  <!-- Back Button -->
  <div class="mb-4">
    <a href="{% url 'blogs' %}" class="btn-back">
      <i class="fas fa-arrow-left me-2"></i>
      Back to All Blogs
    </a>
  </div>

  <!-- Blog Content -->
  <article class="blog-detail glass-card">
    
    <!-- Blog Header -->
    <header class="blog-header mb-4">
      <div class="blog-meta-top mb-3">
        <span class="category-badge">
          <i class="fas fa-folder me-1"></i>
          {{ blog.category }}
        </span>
        <span class="blog-date">
          <i class="fas fa-calendar me-1"></i>
          {{ blog.created|date:"F d, Y" }}
        </span>
      </div>
      
      <h1 class="blog-title-main">{{ blog.title }}</h1>
      
       {% if blog.tags %}
      <div class="blog-tags mt-3">
        <i class="fas fa-tags me-2"></i>
        <span class="tag-item">{{ blog.tags }}</span>
      </div>
      {% endif %}
    </header>

    <!-- Featured Image -->
    <div class="featured-image mb-5">
      <img src="{{ blog.featureImage.url }}" alt="{{ blog.title }}" class="img-fluid">
    </div>

    <!-- Blog Content -->
    <div class="blog-content-text">
      {{ blog.content|linebreaks }}
    </div>

    <!-- Blog Stats (Views, Likes, Dislikes, Comments) -->
    <div class="blog-stats mt-5 pt-4">
      <div class="stats-container">
        <div class="stat-item">
          <i class="fas fa-eye"></i>
          <span id="views-count">{{ blog.views }}</span>
          <span class="stat-label">Views</span>
        </div>

        <div class="stat-divider"></div>

        <div class="stat-item reaction-item">
          {% if user.is_authenticated %}
            <button class="reaction-btn like-btn {% if user_reaction == 'like' %}active{% endif %}"
                    data-reaction="like"
                    data-blog-id="{{ blog.id }}">
              <i class="fas fa-thumbs-up"></i>
              <span id="likes-count">{{ blog.likes_count }}</span>
            </button>
          {% else %}
            <a href="{% url 'login' %}" class="reaction-btn like-btn" title="Login to like">
              <i class="fas fa-thumbs-up"></i>
              <span id="likes-count">{{ blog.likes_count }}</span>
            </a>
          {% endif %}
        </div>

        <div class="stat-item reaction-item">
          {% if user.is_authenticated %}
            <button class="reaction-btn dislike-btn {% if user_reaction == 'dislike' %}active{% endif %}"
                    data-reaction="dislike"
                    data-blog-id="{{ blog.id }}">
              <i class="fas fa-thumbs-down"></i>
              <span id="dislikes-count">{{ blog.dislikes_count }}</span>
            </button>
          {% else %}
            <a href="{% url 'login' %}" class="reaction-btn dislike-btn" title="Login to dislike">
              <i class="fas fa-thumbs-down"></i>
              <span id="dislikes-count">{{ blog.dislikes_count }}</span>
            </a>
          {% endif %}
        </div>

        <div class="stat-divider"></div>

        <div class="stat-item">
          <i class="fas fa-comments"></i>
          <span id="comments-count">{{ blog.comments_count }}</span>
          <span class="stat-label">Comments</span>
        </div>

        <div class="stat-divider"></div>

        <div class="stat-item">
          <span class="small text-secondary">Author : {{ blog.author }}</span>
        </div>
      </div>
    </div>

    <!-- Blog Footer -->
    <footer class="blog-footer mt-5 pt-4">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div class="share-section">
          <span class="share-label">
            <i class="fas fa-share-alt me-2"></i>
            Share this post:
          </span>
          <div class="share-buttons">
            <a href="#" class="share-btn facebook" title="Share on Facebook">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="share-btn twitter" title="Share on Twitter">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="share-btn linkedin" title="Share on LinkedIn">
              <i class="fab fa-linkedin-in"></i>
            </a>
            <a href="#" class="share-btn whatsapp" title="Share on WhatsApp">
              <i class="fab fa-whatsapp"></i>
            </a>
          </div>
        </div>

        <a href="{% url 'blogs' %}" class="btn btn-primary-custom">
          <i class="fas fa-book-open me-2"></i>
          Read More Blogs
        </a>
      </div>
    </footer>

  </article>

  <!-- Comments Section -->
  <section class="comments-section mt-5">
    <div class="glass-card">
      <h3 class="comments-title mb-4">
        <i class="fas fa-comments me-2"></i>
        Comments (<span id="total-comments">{{ comments.count }}</span>)
      </h3>

      <!-- Add Comment Form -->
      {% if user.is_authenticated %}
      <div class="add-comment-box mb-4">
        <form id="comment-form" class="comment-form">
          {% csrf_token %}

          <div class="comment-input-wrapper">
            <textarea
              id="comment-text"
              name="comment_text"
              class="form-control comment-input"
              rows="3"
              placeholder="Write your comment here..."
              required></textarea>
            <button type="submit" class="btn btn-primary-custom mt-3">
              <i class="fas fa-paper-plane me-2"></i>
              Post Comment
            </button>
          </div>
        </form>
      </div>
      {% else %}
      <div class="login-prompt mb-4">
        <p>
          <i class="fas fa-info-circle me-2"></i>
          Please <a href="{% url 'login' %}">login</a> to leave a comment.
        </p>
      </div>
      {% endif %}

      <!-- Comments List -->
      <div id="comments-list" class="comments-list">
        {% for comment in comments %}
        <div class="comment-item" data-comment-id="{{ comment.id }}">
          <div class="comment-content">
            <div class="comment-header">
              <span class="comment-author">{{ comment.user.username }}</span>
              <span class="comment-date">
                <i class="far fa-clock me-1"></i>
                {{ comment.created|date:"F d, Y \a\t g:i A" }}
              </span>
            </div>
            <div class="comment-text">
              {{ comment.text }}
            </div>
            {% if user.is_authenticated and comment.user == user %}
            <div class="comment-actions">
              <button class="delete-comment-btn" data-comment-id="{{ comment.id }}">
                <i class="fas fa-trash-alt me-1"></i>
                Delete
              </button>
            </div>
            {% endif %}
          </div>
        </div>
        {% empty %}
        <div id="no-comments" class="no-comments">
          <i class="far fa-comment-dots"></i>
          <p>No comments yet. Be the first to comment!</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Related Blogs Section -->
  {% if related_blogs %}
  <section class="related-blogs mt-5">
    <h3 class="section-title mb-4">
      <i class="fas fa-newspaper me-2"></i>
      Related Posts
    </h3>
    <div class="row g-5">
      {% for related in related_blogs %}
      <div class="col-md-4">
          <span class="category-badge">
            <i class="fas fa-folder me-1"></i>
            {{ related.category }}
          </span>
        <a href="{% url 'blog' related.id %}" class="related-card glass-card">
          <div class="related-image">
            <img src="{{ related.featureImage.url }}" alt="{{ related.title }}">
          </div>
          <div class="related-content">
            <h5 class="related-title">{{ related.title }}</h5>
            <p class="related-date">
              <i class="fas fa-calendar me-1"></i>
              {{ related.created|date:"M d, Y" }}
            </p>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

</div>

<style>
  /* Glass Card */
  .glass-card {
    background: rgba(255, 255, 255, 0.75);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    padding: 3rem;
    transition: all 0.3s ease;
  }

  /* Back Button */
  .btn-back {
    display: inline-flex;
    align-items: center;
    color: #3498db;
    font-weight: 500;
    text-decoration: none;
    padding: 0.75rem 1.5rem;
    background: rgba(52, 152, 219, 0.1);
    transition: all 0.3s ease;
  }

  .btn-back:hover {
    background: #3498db;
    color: white;
    transform: translateX(-5px);
  }

  /* Blog Header */
  .blog-meta-top {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
  }

  .category-badge {
    background: rgba(52, 152, 219, 0.15);
    color: #3498db;
    padding: 0.5rem 1rem;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .blog-date {
    color: #666;
    font-size: 0.95rem;
  }

  .blog-title-main {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2c3e50;
    line-height: 1.3;
    margin-bottom: 0;
  }

  /* Tags */
  .blog-tags {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
    color: #666;
  }

  .tag-item {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
    padding: 0.4rem 0.875rem;
    font-size: 0.875rem;
    font-weight: 500;
  }

  /* Featured Image */
  .featured-image {
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  }

  .featured-image img {
    width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: cover;
  }

  /* Blog Content */
  .blog-content-text {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #444;
  }

  .blog-content-text p {
    margin-bottom: 1.5rem;
  }

  /* Blog Stats */
  .blog-stats {
    border-top: 2px solid rgba(52, 152, 219, 0.2);
    border-bottom: 2px solid rgba(52, 152, 219, 0.2);
  }

  .stats-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
    padding: 1.5rem 0;
  }

  .stat-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #666;
    font-size: 1rem;
    font-weight: 500;
  }

  .stat-item i {
    font-size: 1.2rem;
    color: #3498db;
  }

  .stat-label {
    font-size: 0.875rem;
    color: #888;
  }

  .stat-divider {
    width: 1px;
    height: 30px;
    background: rgba(52, 152, 219, 0.3);
  }

  /* Reaction Buttons */
  .reaction-item {
    gap: 0;
  }

  .reaction-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: 2px solid rgba(52, 152, 219, 0.3);
    background: transparent;
    color: #666;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .reaction-btn i {
    font-size: 1.1rem;
    color: inherit;
  }

  .reaction-btn:hover {
    background: rgba(52, 152, 219, 0.1);
    border-color: #3498db;
    color: #3498db;
    transform: translateY(-2px);
  }

  .like-btn.active {
    background: rgba(46, 204, 113, 0.15);
    border-color: #2ecc71;
    color: #2ecc71;
  }

  .dislike-btn.active {
    background: rgba(231, 76, 60, 0.15);
    border-color: #e74c3c;
    color: #e74c3c;
  }

  /* Blog Footer */
  .blog-footer {
    border-top: 2px solid rgba(52, 152, 219, 0.2);
  }

  .share-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .share-label {
    font-weight: 600;
    color: #2c3e50;
  }

  .share-buttons {
    display: flex;
    gap: 0.75rem;
  }

  .share-btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
    color: white;
  }

  .share-btn.facebook {
    background: #3b5998;
  }

  .share-btn.facebook:hover {
    background: #2d4373;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(59, 89, 152, 0.4);
  }

  .share-btn.twitter {
    background: #1da1f2;
  }

  .share-btn.twitter:hover {
    background: #0d8bd9;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(29, 161, 242, 0.4);
  }

  .share-btn.linkedin {
    background: #0077b5;
  }

  .share-btn.linkedin:hover {
    background: #005582;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0, 119, 181, 0.4);
  }

  .share-btn.whatsapp {
    background: #25d366;
  }

  .share-btn.whatsapp:hover {
    background: #1da851;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
  }

  /* Button */
  .btn-primary-custom {
    background: #3498db;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
  }

  .btn-primary-custom:hover {
    background: #2980b9;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
    color: white;
  }

  /* Comments Section */
  .comments-section .glass-card {
    padding: 2.5rem;
  }

  .comments-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0;
  }

  .comments-title i {
    color: #3498db;
  }

  /* Add Comment Box */
  .add-comment-box {
    background: rgba(52, 152, 219, 0.05);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .comment-form {
    display: flex;
    gap: 1rem;
  }

  .user-avatar-wrapper {
    flex-shrink: 0;
  }

  .user-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3498db, #2980b9);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
  }

  .comment-input-wrapper {
    flex: 1;
  }

  .comment-input {
    width: 100%;
    border: 2px solid rgba(52, 152, 219, 0.2);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    resize: vertical;
    transition: all 0.3s ease;
  }

  .comment-input:focus {
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    outline: none;
  }

  /* Login Prompt */
  .login-prompt {
    background: rgba(52, 152, 219, 0.1);
    border-left: 4px solid #3498db;
    padding: 1rem 1.5rem;
    border-radius: 8px;
  }

  .login-prompt p {
    margin: 0;
    color: #2c3e50;
    font-weight: 500;
  }

  .login-prompt a {
    color: #3498db;
    font-weight: 600;
    text-decoration: none;
  }

  .login-prompt a:hover {
    text-decoration: underline;
  }

  /* Comments List */
  .comments-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .comment-item {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 12px;
    border: 1px solid rgba(52, 152, 219, 0.1);
    transition: all 0.3s ease;
  }

  .comment-item:hover {
    background: rgba(255, 255, 255, 0.8);
    border-color: rgba(52, 152, 219, 0.3);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }

  .comment-avatar {
    flex-shrink: 0;
  }

  .comment-avatar i {
    font-size: 2.5rem;
    color: #3498db;
  }

  .comment-content {
    flex: 1;
  }

  .comment-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
    flex-wrap: wrap;
  }

  .comment-author {
    font-weight: 700;
    color: #2c3e50;
    font-size: 1rem;
  }

  .comment-date {
    color: #888;
    font-size: 0.875rem;
  }

  .comment-text {
    color: #444;
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 0.75rem;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .comment-actions {
    display: flex;
    gap: 1rem;
  }

  .delete-comment-btn {
    background: transparent;
    border: none;
    color: #e74c3c;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    transition: all 0.3s ease;
  }

  .delete-comment-btn:hover {
    color: #c0392b;
    text-decoration: underline;
  }

  /* No Comments */
  .no-comments {
    text-align: center;
    padding: 3rem 1rem;
    color: #888;
  }

  .no-comments i {
    font-size: 3rem;
    color: #3498db;
    opacity: 0.3;
    margin-bottom: 1rem;
  }

  .no-comments p {
    font-size: 1rem;
    margin: 0;
  }

  /* Related Blogs */
  .section-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: #2c3e50;
  }

  .section-title i {
    color: #3498db;
  }

  .related-card {
    display: block;
    text-decoration: none;
    color: inherit;
    padding: 0;
    overflow: hidden;
    height: 100%;
  }

  .related-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .related-image {
    height: 180px;
    overflow: hidden;
  }

  .related-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .related-card:hover .related-image img {
    transform: scale(1.1);
  }

  .related-content {
    padding: 1.5rem;
  }

  .related-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
  }

  .related-date {
    font-size: 0.875rem;
    color: #666;
    margin: 0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .glass-card {
      padding: 2rem 1.5rem;
    }

    .comments-section .glass-card {
      padding: 1.5rem;
    }

    .blog-title-main {
      font-size: 1.75rem;
    }

    .blog-content-text {
      font-size: 1rem;
    }

    .stats-container {
      gap: 1rem;
    }

    .stat-item {
      font-size: 0.9rem;
    }

    .share-section {
      width: 100%;
      justify-content: center;
    }

    .blog-footer > div {
      flex-direction: column;
      text-align: center;
    }

    .comment-form {
      flex-direction: column;
    }

    .user-avatar-wrapper {
      display: none;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get CSRF token
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');

  // Handle Like/Dislike
  const reactionButtons = document.querySelectorAll('.reaction-btn[data-reaction]');
  reactionButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();

      const reaction = this.dataset.reaction;
      const blogId = this.dataset.blogId;
      const url = `/blog/${blogId}/reaction/${reaction}/`;

      fetch(url, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
          'Content-Type': 'application/json',
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Update counts
          document.getElementById('likes-count').textContent = data.likes;
          document.getElementById('dislikes-count').textContent = data.dislikes;

          // Update button states
          const likeBtn = document.querySelector('.like-btn');
          const dislikeBtn = document.querySelector('.dislike-btn');

          likeBtn.classList.remove('active');
          dislikeBtn.classList.remove('active');

          if (data.user_reaction === 'like') {
            likeBtn.classList.add('active');
          } else if (data.user_reaction === 'dislike') {
            dislikeBtn.classList.add('active');
          }
        } else if (data.error) {
          alert('Error: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
      });
    });
  });

  // Handle Comment Submission
  const commentForm = document.getElementById('comment-form');
  if (commentForm) {
    commentForm.addEventListener('submit', function(e) {
      e.preventDefault();

      const commentText = document.getElementById('comment-text');
      const text = commentText.value.trim();

      if (!text) {
        alert('Please write a comment before submitting.');
        return;
      }

      const blogId = document.querySelector('.reaction-btn[data-blog-id]').dataset.blogId;
      const url = `/blog/${blogId}/add-comment/`;

      const formData = new FormData();
      formData.append('comment_text', text);

      fetch(url, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
        },
        body: formData,
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Clear the input
          commentText.value = '';

          // Remove "no comments" message if exists
          const noComments = document.getElementById('no-comments');
          if (noComments) {
            noComments.remove();
          }

          // Add new comment to the top of the list
          const commentsList = document.getElementById('comments-list');
          const newComment = createCommentElement(data.comment);
          commentsList.insertAdjacentHTML('afterbegin', newComment);

          // Update comment count
          document.getElementById('comments-count').textContent = data.comments_count;
          document.getElementById('total-comments').textContent = data.comments_count;

          // Show success message
          showNotification('Comment posted successfully!', 'success');
        } else if (data.error) {
          alert('Error: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
      });
    });
  }

  // Handle Comment Deletion
  document.addEventListener('click', function(e) {
    if (e.target.closest('.delete-comment-btn')) {
      e.preventDefault();

      const btn = e.target.closest('.delete-comment-btn');
      const commentId = btn.dataset.commentId;

      if (confirm('Are you sure you want to delete this comment?')) {
        const url = `/comment/${commentId}/delete/`;

        fetch(url, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken,
          },
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Remove comment from DOM
            const commentItem = document.querySelector(`[data-comment-id="${commentId}"]`);
            commentItem.remove();

            // Update comment count
            document.getElementById('comments-count').textContent = data.comments_count;
            document.getElementById('total-comments').textContent = data.comments_count;

            // Show "no comments" if list is empty
            const commentsList = document.getElementById('comments-list');
            if (commentsList.children.length === 0) {
              commentsList.innerHTML = `
                <div id="no-comments" class="no-comments">
                  <i class="far fa-comment-dots"></i>
                  <p>No comments yet. Be the first to comment!</p>
                </div>
              `;
            }

            // Show success message
            showNotification('Comment deleted successfully!', 'success');
          } else if (data.error) {
            alert('Error: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred. Please try again.');
        });
      }
    }
  });

  // Create comment HTML element
  function createCommentElement(comment) {
    return `
      <div class="comment-item" data-comment-id="${comment.id}">
        <div class="comment-avatar">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="comment-content">
          <div class="comment-header">
            <span class="comment-author">${comment.user}</span>
            <span class="comment-date">
              <i class="far fa-clock me-1"></i>
              ${comment.created}
            </span>
          </div>
          <div class="comment-text">${escapeHtml(comment.text)}</div>
          <div class="comment-actions">
            <button class="delete-comment-btn" data-comment-id="${comment.id}">
              <i class="fas fa-trash-alt me-1"></i>
              Delete
            </button>
          </div>
        </div>
      </div>
    `;
  }

  // Escape HTML to prevent XSS
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // Show notification (optional - you can customize this)
  function showNotification(message, type) {
    // Simple alert for now - you can replace with a better notification system
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      background: ${type === 'success' ? '#2ecc71' : '#e74c3c'};
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 9999;
      font-weight: 500;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.opacity = '0';
      notification.style.transition = 'opacity 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }
});
</script>
{% endblock maincontent %}